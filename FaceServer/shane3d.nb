(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     44853,       1302]
NotebookOptionsPosition[     43724,       1263]
NotebookOutlinePosition[     44074,       1278]
CellTagsIndexPosition[     44031,       1275]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"tmat", ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "1", ",", " ", "0", ",", " ", "0"}], "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "0", ",", " ", "1", ",", " ", "0"}], "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"#1", ",", "#2", ",", "#3", ",", " ", "1"}], "}"}]}], "}"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"rmatd", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "c", ",", " ", "s", ",", " ", "t", ",", " ", "x", ",", " ", "y", ",", 
      " ", "z"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"t", "*", "x", "*", "x"}], "+", "c"}], ",", 
        RowBox[{
         RowBox[{"t", "*", "x", "*", "y"}], "-", 
         RowBox[{"z", "*", "s"}]}], ",", 
        RowBox[{
         RowBox[{"t", "*", "x", "*", "z"}], "+", 
         RowBox[{"y", "*", "s"}]}], ",", " ", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"t", "*", "x", "*", "y"}], "+", 
         RowBox[{"z", "*", "s"}]}], ",", 
        RowBox[{
         RowBox[{"t", "*", "y", "*", "y"}], "+", "c"}], ",", 
        RowBox[{
         RowBox[{"t", "*", "y", "*", "z"}], "-", 
         RowBox[{"x", "*", "s"}]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"t", "*", "x", "*", "z"}], "-", 
         RowBox[{"y", "*", "s"}]}], ",", 
        RowBox[{
         RowBox[{"t", "*", "y", "*", "z"}], "+", 
         RowBox[{"x", "*", "s"}]}], ",", 
        RowBox[{
         RowBox[{"t", "*", "z", "*", "z"}], "+", "c"}], ",", "0"}], "}"}], 
      ",", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rmat", " ", ":=", " ", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz"}], "}"}], 
     ",", " ", 
     RowBox[{"rmatd", "[", 
      RowBox[{
       RowBox[{"Cos", "[", "r", "]"}], ",", " ", 
       RowBox[{"Sin", "[", "r", "]"}], ",", " ", 
       RowBox[{"1", " ", "-", " ", 
        RowBox[{"Cos", "[", "r", "]"}]}], ",", " ", "ux", ",", " ", "uy", ",",
        " ", "uz"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"pt0", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{"n", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Subscript", "[", 
        RowBox[{"x", ",", "src"}], "]"}], "[", "n", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Subscript", "[", 
        RowBox[{"y", ",", "src"}], "]"}], "[", "n", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Subscript", "[", 
        RowBox[{"z", ",", "src"}], "]"}], "[", "n", "]"}], ",", " ", "1"}], 
     "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"pt1", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{"n", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Subscript", "[", 
        RowBox[{"x", ",", "dst"}], "]"}], "[", "n", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Subscript", "[", 
        RowBox[{"y", ",", "dst"}], "]"}], "[", "n", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Subscript", "[", 
        RowBox[{"z", ",", "dst"}], "]"}], "[", "n", "]"}], ",", " ", "1"}], 
     "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"dpt", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "}"}], ",", " ", 
    RowBox[{
     RowBox[{"pt1", "[", "n", "]"}], " ", "-", " ", 
     RowBox[{
      RowBox[{"pt0", " ", "[", "n", "]"}], " ", ".", " ", 
      RowBox[{"rmat", "[", 
       RowBox[{"r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz"}], "]"}], 
      " ", ".", " ", 
      RowBox[{"tmat", "[", 
       RowBox[{"tx", ",", "ty", ",", "tz"}], "]"}]}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dptlnsq", " ", ":=", " ", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",",
        " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"dpt", "[", 
         RowBox[{
         "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", 
          ",", " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], " ", "+", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"dpt", "[", 
         RowBox[{
         "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", 
          ",", " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], " ", "+", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"dpt", "[", 
         RowBox[{
         "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", 
          ",", " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}], "^", "2"}]}]}], "]"}]}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dptsum", " ", ":=", " ", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",",
        " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "}"}], ",", " ", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"dptlnsq", "[", 
        RowBox[{
        "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", 
         ",", " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "0", ",", " ", "k"}], "}"}]}], "]"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"dptsum", "[", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", "r"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"dptsum", "[", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", "ux"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"dptsum", "[", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", "uy"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"dptsum", "[", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", "tx"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"dptsum", "[", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", "ty"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"dptsum", "[", 
     RowBox[{
     "n", ",", " ", "r", ",", " ", "ux", ",", " ", "uy", ",", " ", "uz", ",", 
      " ", "tx", ",", " ", "ty", ",", " ", "tz"}], "]"}], ",", " ", "tz"}], 
   "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.773699252617465*^9, 3.773699271896155*^9}, {
   3.7736996249645796`*^9, 3.773699904987915*^9}, {3.773699986787138*^9, 
   3.77370027195979*^9}, {3.7737003142639437`*^9, 3.7737004457908883`*^9}, {
   3.77370049328934*^9, 3.7737005478314857`*^9}, {3.773700584287551*^9, 
   3.7737006337343645`*^9}, {3.7737006643593407`*^9, 
   3.7737007239898186`*^9}, {3.7737007581646338`*^9, 3.773700799931962*^9}, {
   3.773700891996825*^9, 3.77370089582757*^9}, 3.773701089778079*^9, {
   3.7737011244427357`*^9, 3.773701235801279*^9}, {3.773955838959975*^9, 
   3.7739558626492205`*^9}, {3.7739562157406406`*^9, 
   3.7739562192684827`*^9}, {3.7739563182186937`*^9, 3.773956363305938*^9}, {
   3.7740451743470716`*^9, 3.7740451959719925`*^9}, {3.7740452268608847`*^9, 
   3.7740452432675104`*^9}, {3.774132830450403*^9, 3.774132952145564*^9}, {
   3.774132998469404*^9, 3.774133031872466*^9}, {3.774133068039625*^9, 
   3.774133088222023*^9}, {3.7741340473356047`*^9, 3.7741340641121087`*^9}, {
   3.774134226480958*^9, 3.7741342708634295`*^9}, {3.774389874883636*^9, 
   3.7743898763736887`*^9}, {3.7743906172752905`*^9, 3.774390625494447*^9}, {
   3.774390720713663*^9, 3.7743907418326397`*^9}, {3.7743909608485823`*^9, 
   3.774390961844819*^9}, 3.774391016333466*^9, {3.7745631355373516`*^9, 
   3.774563205154652*^9}, {3.8016099784484034`*^9, 3.801610001610261*^9}, {
   3.802185702833422*^9, 3.8021857039555264`*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"pt0", " ", ":=", " ", 
    RowBox[{"Function", "[", 
     RowBox[{"n", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"x", ",", "src"}], "]"}], "[", "n", "]"}], " ", "+", " ", 
         "tx"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"y", ",", "src"}], "]"}], "[", "n", "]"}], " ", "+", " ", 
         "ty"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"z", ",", "src"}], "]"}], "[", "n", "]"}], " ", "+", " ", 
         "tz"}], ",", " ", "1"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"pt1", " ", ":=", " ", 
    RowBox[{"Function", "[", 
     RowBox[{"n", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Subscript", "[", 
          RowBox[{"x", ",", "dst"}], "]"}], "[", "n", "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Subscript", "[", 
          RowBox[{"y", ",", "dst"}], "]"}], "[", "n", "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Subscript", "[", 
          RowBox[{"z", ",", "dst"}], "]"}], "[", "n", "]"}], ",", " ", "1"}], 
       "}"}]}], "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.801610014524392*^9, 3.8016100348583345`*^9}, {
  3.8016104050335655`*^9, 3.801610428369321*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ddpt", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"pt1", "[", "n", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"pt0", "[", "n", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "^", "2"}], " ", "+", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"pt1", "[", "n", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"pt0", "[", "n", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "^", "2"}], " ", "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"pt1", "[", "n", "]"}], "[", 
       RowBox[{"[", "3", "]"}], "]"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"pt0", "[", "n", "]"}], "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ")"}], "^", 
    "2"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"D", "[", 
  RowBox[{"ddpt", ",", " ", "tx"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"D", "[", 
  RowBox[{"ddpt", ",", " ", "ty"}], "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8016101717646523`*^9, 3.8016102134103804`*^9}, {
  3.801610340333597*^9, 3.801610358940432*^9}, {3.801610438825697*^9, 
  3.8016104537105703`*^9}, {3.801612080598719*^9, 3.801612184834587*^9}, {
  3.801612225271329*^9, 3.8016122290550346`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "2"}], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"-", "tx"}], "+", 
    RowBox[{
     SubscriptBox["x", "dst"], "[", "n", "]"}], "-", 
    RowBox[{
     SubscriptBox["x", "src"], "[", "n", "]"}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.8016121660117874`*^9, 3.801612187548051*^9}, 
   3.801612232895704*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "2"}], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"-", "ty"}], "+", 
    RowBox[{
     SubscriptBox["y", "dst"], "[", "n", "]"}], "-", 
    RowBox[{
     SubscriptBox["y", "src"], "[", "n", "]"}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.8016121660117874`*^9, 3.801612187548051*^9}, 
   3.801612232897707*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", 
   RowBox[{
    RowBox[{"-", "2"}], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", "ty"}], "+", 
      RowBox[{
       SubscriptBox["y", "dst"], "[", "n", "]"}], "-", 
      RowBox[{
       SubscriptBox["y", "src"], "[", "n", "]"}]}], ")"}]}], ",", "0", ",", 
   "0"}], "}"}]], "Input",
 CellChangeTimes->{{3.801610507961697*^9, 3.801610507975709*^9}, 
   3.801693526426981*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"0", ",", "0", ",", 
    RowBox[{
     RowBox[{"-", "2"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "tz"}], "+", 
       RowBox[{
        SubscriptBox["z", "dst"], "[", "n", "]"}], "-", 
       RowBox[{
        SubscriptBox["z", "src"], "[", "n", "]"}]}], ")"}]}], ",", "0"}], 
   "}"}], "\[AliasDelimiter]"}]], "Input",
 CellChangeTimes->{{3.801693565621895*^9, 3.8016935656349087`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"p", " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"px", ",", " ", "py", ",", " ", "pz"}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"v", " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"vx", ",", " ", "vy", ",", " ", "vz"}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"u", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"qx", ",", " ", "qy", ",", " ", "qz"}], "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"s", " ", ":=", " ", "qw"}], "\[IndentingNewLine]", 
   RowBox[{"qtrans", " ", ":=", " ", 
    RowBox[{
     RowBox[{"2", "  ", "*", " ", 
      RowBox[{"u", ".", " ", "v"}], " ", "*", " ", "u"}], " ", "+", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"s", " ", "*", " ", "s"}], " ", "-", " ", 
        RowBox[{"(", 
         RowBox[{"u", " ", ".", " ", "u"}], ")"}]}], ")"}], " ", "*", " ", 
      "v"}], " ", "+", " ", 
     RowBox[{"2", " ", "*", " ", "s", "  ", "*", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{"u", ",", " ", "v"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{"d", "  ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{"p", " ", "-", " ", "qtrans"}], ")"}]}], "\[IndentingNewLine]", 
   RowBox[{"dist", " ", ":=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"d", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], " ", "+", " ", 
     RowBox[{
      RowBox[{"d", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], " ", "+", " ", 
     RowBox[{
      RowBox[{"d", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "^", "2"}]}]}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{"Simplify", "[", 
    RowBox[{"D", "[", 
     RowBox[{"dist", ",", " ", "qx"}], "]"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Simplify", "[", 
    RowBox[{"D", "[", 
     RowBox[{"dist", ",", " ", "qy"}], "]"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Simplify", "[", 
    RowBox[{"D", "[", 
     RowBox[{"dist", ",", " ", "qz"}], "]"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Simplify", "[", 
    RowBox[{"D", "[", 
     RowBox[{"dist", ",", " ", "qw"}], "]"}], "]"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{
  3.801693712270997*^9, {3.801693776091401*^9, 3.801693866894269*^9}, {
   3.8016939013729253`*^9, 3.801693910335591*^9}, 3.80169395617767*^9, {
   3.8016939947600193`*^9, 3.801694150344962*^9}, {3.801694242035407*^9, 
   3.8016942803519964`*^9}, {3.801694330862613*^9, 3.8016943395583124`*^9}, {
   3.8016943737090077`*^9, 3.8016944112547398`*^9}, {3.80169444894262*^9, 
   3.8016944514075775`*^9}, {3.801694495635151*^9, 3.8016945306641026`*^9}, {
   3.8016945825906754`*^9, 3.801694615822467*^9}, {3.801694661151216*^9, 
   3.8016947167079077`*^9}, {3.8016948545566587`*^9, 3.8016949651900945`*^9}}],

Cell[BoxData[
 RowBox[{"4", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "pz"}], " ", "qz", " ", "vx"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qx", " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "3"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"qx", " ", 
     SuperscriptBox["qy", "2"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"qx", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vx", "2"]}], "-", 
    RowBox[{"pz", " ", "qw", " ", "vy"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qx", " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "3"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"qx", " ", 
     SuperscriptBox["qy", "2"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"qx", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"pz", " ", "qx", " ", "vz"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qx", " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "3"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"qx", " ", 
     SuperscriptBox["qy", "2"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"qx", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"py", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "qy"}], " ", "vx"}], "+", 
       RowBox[{"qx", " ", "vy"}], "+", 
       RowBox[{"qw", " ", "vz"}]}], ")"}]}], "-", 
    RowBox[{"px", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qx", " ", "vx"}], "+", 
       RowBox[{"qy", " ", "vy"}], "+", 
       RowBox[{"qz", " ", "vz"}]}], ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8016940025540423`*^9, 3.801694033152343*^9, 3.8016940777247286`*^9, 
   3.8016941080966825`*^9, 3.8016942809124875`*^9, 3.801694379169905*^9, 
   3.801694411942521*^9, 3.8016945702149687`*^9, {3.8016946007343884`*^9, 
   3.8016946166161737`*^9}, 3.801694721832679*^9, {3.8016948885130596`*^9, 
   3.8016949659087305`*^9}}],

Cell[BoxData[
 RowBox[{"4", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"px", " ", "qy", " ", "vx"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qy", " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "2"], " ", "qy", " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qy", "3"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"qy", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vx", "2"]}], "-", 
    RowBox[{"px", " ", "qx", " ", "vy"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qy", " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "2"], " ", "qy", " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qy", "3"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"qy", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vy", "2"]}], "-", 
    RowBox[{"px", " ", "qw", " ", "vz"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qy", " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "2"], " ", "qy", " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qy", "3"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"qy", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"pz", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qw", " ", "vx"}], "-", 
       RowBox[{"qz", " ", "vy"}], "+", 
       RowBox[{"qy", " ", "vz"}]}], ")"}]}], "-", 
    RowBox[{"py", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qx", " ", "vx"}], "+", 
       RowBox[{"qy", " ", "vy"}], "+", 
       RowBox[{"qz", " ", "vz"}]}], ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8016940025540423`*^9, 3.801694033152343*^9, 3.8016940777247286`*^9, 
   3.8016941080966825`*^9, 3.8016942809124875`*^9, 3.801694379169905*^9, 
   3.801694411942521*^9, 3.8016945702149687`*^9, {3.8016946007343884`*^9, 
   3.8016946166161737`*^9}, 3.801694721832679*^9, {3.8016948885130596`*^9, 
   3.801694965928749*^9}}],

Cell[BoxData[
 RowBox[{"4", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"px", " ", "qz", " ", "vx"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qz", " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "2"], " ", "qz", " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qy", "2"], " ", "qz", " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qz", "3"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"px", " ", "qw", " ", "vy"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qz", " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "2"], " ", "qz", " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qy", "2"], " ", "qz", " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qz", "3"], " ", 
     SuperscriptBox["vy", "2"]}], "-", 
    RowBox[{"px", " ", "qx", " ", "vz"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "2"], " ", "qz", " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qx", "2"], " ", "qz", " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qy", "2"], " ", "qz", " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{
     SuperscriptBox["qz", "3"], " ", 
     SuperscriptBox["vz", "2"]}], "-", 
    RowBox[{"py", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qw", " ", "vx"}], "-", 
       RowBox[{"qz", " ", "vy"}], "+", 
       RowBox[{"qy", " ", "vz"}]}], ")"}]}], "-", 
    RowBox[{"pz", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qx", " ", "vx"}], "+", 
       RowBox[{"qy", " ", "vy"}], "+", 
       RowBox[{"qz", " ", "vz"}]}], ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8016940025540423`*^9, 3.801694033152343*^9, 3.8016940777247286`*^9, 
   3.8016941080966825`*^9, 3.8016942809124875`*^9, 3.801694379169905*^9, 
   3.801694411942521*^9, 3.8016945702149687`*^9, {3.8016946007343884`*^9, 
   3.8016946166161737`*^9}, 3.801694721832679*^9, {3.8016948885130596`*^9, 
   3.801694965943763*^9}}],

Cell[BoxData[
 RowBox[{"4", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "py"}], " ", "qz", " ", "vx"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "3"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qx", "2"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qy", "2"], " ", 
     SuperscriptBox["vx", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vx", "2"]}], "-", 
    RowBox[{"py", " ", "qw", " ", "vy"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "3"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qx", "2"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qy", "2"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vy", "2"]}], "+", 
    RowBox[{"py", " ", "qx", " ", "vz"}], "+", 
    RowBox[{
     SuperscriptBox["qw", "3"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qx", "2"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qy", "2"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"qw", " ", 
     SuperscriptBox["qz", "2"], " ", 
     SuperscriptBox["vz", "2"]}], "+", 
    RowBox[{"pz", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qy", " ", "vx"}], "-", 
       RowBox[{"qx", " ", "vy"}], "-", 
       RowBox[{"qw", " ", "vz"}]}], ")"}]}], "-", 
    RowBox[{"px", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qw", " ", "vx"}], "-", 
       RowBox[{"qz", " ", "vy"}], "+", 
       RowBox[{"qy", " ", "vz"}]}], ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8016940025540423`*^9, 3.801694033152343*^9, 3.8016940777247286`*^9, 
   3.8016941080966825`*^9, 3.8016942809124875`*^9, 3.801694379169905*^9, 
   3.801694411942521*^9, 3.8016945702149687`*^9, {3.8016946007343884`*^9, 
   3.8016946166161737`*^9}, 3.801694721832679*^9, {3.8016948885130596`*^9, 
   3.8016949659607773`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"p", " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"px", ",", " ", "py", ",", " ", "pz"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"q", " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"qx", ",", " ", "qy", ",", " ", "qz"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"n", " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"nx", ",", " ", "ny", ",", " ", "nz"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"t", " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"tx", ",", " ", "ty", ",", " ", "tz"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"r", " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"rx", ",", " ", "ry", ",", " ", "rz"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"trn", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", " ", "v"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
       RowBox[{"t", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
       RowBox[{"t", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "3", "]"}], "]"}], " ", "+", " ", 
       RowBox[{"t", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"rotx", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", " ", "v"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", 
        RowBox[{"Cos", "[", "a", "]"}]}], " ", "-", " ", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], " ", 
        RowBox[{"Sin", "[", "a", "]"}]}]}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", 
        RowBox[{"Sin", "[", "a", "]"}]}], " ", "+", " ", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], " ", 
        RowBox[{"Cos", "[", "a", "]"}]}]}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"roty", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", " ", "v"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", 
        RowBox[{"Cos", "[", "a", "]"}]}], " ", "-", " ", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], " ", 
        RowBox[{"Sin", "[", "a", "]"}]}]}], ",", " ", 
      RowBox[{"v", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", 
        RowBox[{"Sin", "[", "a", "]"}]}], " ", "+", " ", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], " ", 
        RowBox[{"Cos", "[", "a", "]"}]}]}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"rotz", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", " ", "v"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", 
        RowBox[{"Cos", "[", "a", "]"}]}], " ", "-", " ", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", 
        RowBox[{"Sin", "[", "a", "]"}]}]}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", 
        RowBox[{"Sin", "[", "a", "]"}]}], " ", "+", " ", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", 
        RowBox[{"Cos", "[", "a", "]"}]}]}], ",", " ", 
      RowBox[{"v", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"rot", " ", ":=", " ", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"r", ",", " ", "v"}], "}"}], ",", " ", 
    RowBox[{"rotx", "[", 
     RowBox[{
      RowBox[{"r", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
      RowBox[{"roty", "[", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
        RowBox[{"rotz", "[", 
         RowBox[{
          RowBox[{"r", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", "v"}], "]"}]}], "]"}]}], 
     "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"d", " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{"p", " ", "-", " ", 
    RowBox[{"rot", "[", 
     RowBox[{"r", ",", " ", "q"}], "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"dist", " ", ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"d", " ", ".", " ", "n"}], ")"}], " ", "*", " ", 
   RowBox[{"(", 
    RowBox[{"d", " ", ".", "n"}], " ", ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{"dist", ",", " ", "rx"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{"dist", ",", " ", "ry"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Simplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{"dist", ",", " ", "rz"}], "]"}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQveftr3/iIW8cxQL/MksA6anf7TlA9KGD7WogWibm
jQ6IXry80AFEL4oJdAHR39b6xIFoligeD1UgnVe8whNEm7FcCgTRn/NuBoPo
OiebRH8gbRcZkQain1h4NYLoGNFdYPpTvGdcIJDumaaUCqLfGXJeTAfSJ7ad
vgyiWbJ474DoqGiZByA6wZflCYjWEhV9AaJf8vN8A9EzRe0YM4C0jnzO6iog
PW2P8nYQbeNadXomkD5YN/cyiL7CcPE2iD4xW/cBiD7HYP4KRHP9/vUOREu0
H5dYAaQP3JORBNEaFf/EzgPpB6wVyiC67v1yIxBdNjHEAUSfytuzDUQ/3aZ+
EUQDAB5Cohw=
  "]],

Cell[BoxData[
 RowBox[{"2", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", "rx", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ny", " ", "qz", " ", 
        RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "rz", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "nz"}], " ", "qy"}], "+", 
          RowBox[{"ny", " ", "qx", " ", 
           RowBox[{"Sin", "[", "ry", "]"}]}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"nz", " ", "qx"}], "+", 
          RowBox[{"ny", " ", "qy", " ", 
           RowBox[{"Sin", "[", "ry", "]"}]}]}], ")"}], " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"Sin", "[", "rx", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"nz", " ", "qz", " ", 
        RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "rz", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ny", " ", "qy"}], "+", 
          RowBox[{"nz", " ", "qx", " ", 
           RowBox[{"Sin", "[", "ry", "]"}]}]}], ")"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ny", " ", "qx"}], "-", 
          RowBox[{"nz", " ", "qy", " ", 
           RowBox[{"Sin", "[", "ry", "]"}]}]}], ")"}], " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"nx", " ", 
     RowBox[{"(", 
      RowBox[{"px", "+", 
       RowBox[{"qz", " ", 
        RowBox[{"Sin", "[", "ry", "]"}]}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "ry", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "qx"}], " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qy", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{"nz", " ", 
     RowBox[{"(", 
      RowBox[{"pz", "-", 
       RowBox[{
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qy", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qx", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qz", " ", 
           RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
          RowBox[{
           RowBox[{"Sin", "[", "ry", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"qx", " ", 
              RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
             RowBox[{"qy", " ", 
              RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
      ")"}]}], "+", 
    RowBox[{"ny", " ", 
     RowBox[{"(", 
      RowBox[{"py", "-", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qy", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qx", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "+", 
       RowBox[{
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qz", " ", 
           RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
          RowBox[{
           RowBox[{"Sin", "[", "ry", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"qx", " ", 
              RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
             RowBox[{"qy", " ", 
              RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
      ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8025609963089275`*^9, 3.802561027604616*^9, {3.8025621103261538`*^9, 
   3.8025621551881914`*^9}, 3.8025621867629676`*^9}],

Cell[BoxData[
 RowBox[{"2", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Sin", "[", "ry", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"nz", " ", "qz", " ", 
        RowBox[{"Cos", "[", "rx", "]"}]}], "+", 
       RowBox[{"nx", " ", "qx", " ", 
        RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
       RowBox[{"ny", " ", "qz", " ", 
        RowBox[{"Sin", "[", "rx", "]"}]}], "-", 
       RowBox[{"nx", " ", "qy", " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"Cos", "[", "ry", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"nx", " ", "qz"}], "+", 
       RowBox[{"ny", " ", "qx", " ", 
        RowBox[{"Cos", "[", "rz", "]"}], " ", 
        RowBox[{"Sin", "[", "rx", "]"}]}], "-", 
       RowBox[{"ny", " ", "qy", " ", 
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "nz"}], " ", "qx", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"nz", " ", "qy", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], ")"}], 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"nx", " ", 
     RowBox[{"(", 
      RowBox[{"px", "+", 
       RowBox[{"qz", " ", 
        RowBox[{"Sin", "[", "ry", "]"}]}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "ry", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "qx"}], " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qy", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{"nz", " ", 
     RowBox[{"(", 
      RowBox[{"pz", "-", 
       RowBox[{
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qy", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qx", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qz", " ", 
           RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
          RowBox[{
           RowBox[{"Sin", "[", "ry", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"qx", " ", 
              RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
             RowBox[{"qy", " ", 
              RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
      ")"}]}], "+", 
    RowBox[{"ny", " ", 
     RowBox[{"(", 
      RowBox[{"py", "-", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qy", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qx", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "+", 
       RowBox[{
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qz", " ", 
           RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
          RowBox[{
           RowBox[{"Sin", "[", "ry", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"qx", " ", 
              RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
             RowBox[{"qy", " ", 
              RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
      ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8025609963089275`*^9, 3.802561027604616*^9, {3.8025621103261538`*^9, 
   3.8025621551881914`*^9}, 3.802562187121826*^9}],

Cell[BoxData[
 RowBox[{"2", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"nx", " ", 
     RowBox[{"Cos", "[", "ry", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"qy", " ", 
        RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
       RowBox[{"qx", " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "-", 
    RowBox[{
     RowBox[{"Sin", "[", "rx", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"nz", " ", "qx", " ", 
        RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
       RowBox[{"ny", " ", "qy", " ", 
        RowBox[{"Cos", "[", "rz", "]"}], " ", 
        RowBox[{"Sin", "[", "ry", "]"}]}], "-", 
       RowBox[{"nz", " ", "qy", " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}], "+", 
       RowBox[{"ny", " ", "qx", " ", 
        RowBox[{"Sin", "[", "ry", "]"}], " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"Cos", "[", "rx", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Cos", "[", "rz", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "ny"}], " ", "qx"}], "+", 
          RowBox[{"nz", " ", "qy", " ", 
           RowBox[{"Sin", "[", "ry", "]"}]}]}], ")"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ny", " ", "qy"}], "+", 
          RowBox[{"nz", " ", "qx", " ", 
           RowBox[{"Sin", "[", "ry", "]"}]}]}], ")"}], " ", 
        RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"nx", " ", 
     RowBox[{"(", 
      RowBox[{"px", "+", 
       RowBox[{"qz", " ", 
        RowBox[{"Sin", "[", "ry", "]"}]}], "+", 
       RowBox[{
        RowBox[{"Cos", "[", "ry", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "qx"}], " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qy", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{"nz", " ", 
     RowBox[{"(", 
      RowBox[{"pz", "-", 
       RowBox[{
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qy", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qx", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qz", " ", 
           RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
          RowBox[{
           RowBox[{"Sin", "[", "ry", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"qx", " ", 
              RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
             RowBox[{"qy", " ", 
              RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
      ")"}]}], "+", 
    RowBox[{"ny", " ", 
     RowBox[{"(", 
      RowBox[{"py", "-", 
       RowBox[{
        RowBox[{"Cos", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qy", " ", 
           RowBox[{"Cos", "[", "rz", "]"}]}], "+", 
          RowBox[{"qx", " ", 
           RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}], "+", 
       RowBox[{
        RowBox[{"Sin", "[", "rx", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"qz", " ", 
           RowBox[{"Cos", "[", "ry", "]"}]}], "+", 
          RowBox[{
           RowBox[{"Sin", "[", "ry", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"qx", " ", 
              RowBox[{"Cos", "[", "rz", "]"}]}], "-", 
             RowBox[{"qy", " ", 
              RowBox[{"Sin", "[", "rz", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
      ")"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.8025609963089275`*^9, 3.802561027604616*^9, {3.8025621103261538`*^9, 
   3.8025621551881914`*^9}, 3.802562187464137*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.802212993544874*^9, 3.802212996525667*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"D", "[", 
  RowBox[{
   RowBox[{"Cos", "[", "a", "]"}], ",", " ", "a"}], "]"}]], "Input",
 CellChangeTimes->{{3.8022128866977453`*^9, 3.802212890147939*^9}}],

Cell[BoxData[
 RowBox[{"-", 
  RowBox[{"Sin", "[", "a", "]"}]}]], "Output",
 CellChangeTimes->{3.802212891244936*^9}]
}, Open  ]]
},
WindowSize->{1545, 877},
WindowMargins->{{Automatic, 455}, {Automatic, 168}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 9411, 237, 335, "Input"],
Cell[9972, 259, 1485, 39, 107, "Input"],
Cell[CellGroupData[{
Cell[11482, 302, 1402, 38, 88, "Input"],
Cell[12887, 342, 354, 11, 30, "Output"],
Cell[13244, 355, 354, 11, 30, "Output"]
}, Open  ]],
Cell[13613, 369, 438, 14, 30, "Input"],
Cell[14054, 385, 458, 14, 30, "Input"],
Cell[CellGroupData[{
Cell[14537, 403, 2767, 66, 259, "Input"],
Cell[17307, 471, 2182, 62, 34, "Output"],
Cell[19492, 535, 2135, 60, 34, "Output"],
Cell[21630, 597, 2135, 60, 34, "Output"],
Cell[23768, 659, 2158, 61, 34, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25963, 725, 5930, 175, 316, "Input"],
Cell[31896, 902, 3853, 115, 69, "Output"],
Cell[35752, 1019, 3636, 107, 69, "Output"],
Cell[39391, 1128, 3884, 115, 69, "Output"]
}, Open  ]],
Cell[43290, 1246, 92, 1, 30, "Input"],
Cell[CellGroupData[{
Cell[43407, 1251, 181, 4, 30, "Input"],
Cell[43591, 1257, 117, 3, 30, "Output"]
}, Open  ]]
}
]
*)

